var SLP_Location_Manager=SLP_Location_Manager||{},SLP_Location_Form_Handler=(SLP_Location_Manager.vue=function(){return this.initialize=function(){this.load_app=new Vue({vuetify:new Vuetify,el:"#wpcsl-option-load",data:location_manager,methods:{load_locations:function(){var t=this,o=(t.boolean.site_import_protocol?"https://":"http://")+t.site_import_url+"/wp-json/store-locator-plus/v2/locations";t.boolean.loading_locations=!0,t.notices=[],t.notices.push(t.text.starting_message),fetch(o).then(function(a){a.json().then(function(a){a.forEach(function(a){!async function(a){return(await fetch(o+"/"+a)).json()}(a.sl_id).then(function(a){t.locations.push(a),t.add_location(a)})})}),t.boolean.loading_locations=!1}).catch(function(a){t.notices.push(a.message),t.boolean.loading_locations=!1})},add_location:function(t){var o=this;jQuery.ajax({url:o.rest_url+"locations/",method:"POST",data:JSON.stringify(t),contentType:"application/json",beforeSend:function(a){a.setRequestHeader("X-WP-Nonce",o.rest_nonce)},success:function(a){t.is_loaded=!0},error:function(a){a=a.responseText||error_reponse;o.notices=[a]}})}}}),this.update_app=new Vue({vuetify:new Vuetify,el:"#wpcsl-option-add",data:{act:"add",show_add_dialog:!1,location:{},location_manager:location_manager},methods:{close_add_dialog:function(a){SLP_Location_Manager.Editor.close()},submit_form:function(){AdminUI.doAction(this.act)}}})},{load_app:void 0,update_app:void 0,initialize:initialize}}(),function(){this.populate_field=function(a,t,o){var e="[data-field='"+a+"']";return this.set_value(o.find(e),this.get_value(t.find(e))),a},this.get_value=function(a){a=a.attr("data-value")?a.attr("data-value"):a.attr("value")?a.val():a.html();return a},this.set_value=function(a,t){a.is(":checkbox")?a.prop("checked",0<t):a.is("input")?a.val(t):a.html(t)},this.hide=function(a){a.removeClass("unhidden"),a.addClass("hidden"),a.hide()},this.show=function(a){a.removeClass("hidden"),a.addClass("unhidden"),a.show()}}),SLP_Locations_map=function(){this.get_map_div=function(a){let t;return(t=a.find(".location_map")).length||(t=jQuery("#edit_location_map")).length||(t=a.find("#slp_location_edit_embedmap")).length?t:[]},this.show_map=function(a){var t,o,e;void 0!==a&&(e=this.get_map_div(a)).length&&(t=SLP_Location_Manager.Form_Handler.get_value(a.find('[data-field="sl_latitude"]')),o=SLP_Location_Manager.Form_Handler.get_value(a.find('[data-field="sl_longitude"]')),t&&o&&(t=new google.maps.LatLng(t,o),this.map=new google.maps.Map(e[0],{center:t,disableDefaultUI:!0,draggable:!0,disableDoubleClickZoom:!0,keyboardShortcuts:!1,zoom:14}),o={position:t,map:this.map,title:a.find('[data-field="sl_store"]').html(),icon:this.set_icon(a)},this.marker=new google.maps.Marker(o),slp_Admin_Filter("location_map_initialized").publish()))},this.set_icon=function(a){var t=a.find('[data-field="marker"] img').attr("src");return t=(t=t||a.find('[data-field="category_marker"]').attr("src"))||location_manager.default_marker},this.add_marker_at_center=function(){this.centerMarker=new slp_Marker(this,"",this.homePoint,this.mapHomeIconUrl)}},SLP_Locations_table=function(){this.initialize=function(){jQuery('a[data-action="delete"]').on("click",this.delete_location),jQuery('td[data-field="sl_description"]').on("click",this.show_description),slp_Admin_Filter("locations_table_init").publish()},this.delete_location=function(a){var t=new Object,o=(t.action="slp_delete_location",t.location_id=jQuery(this).attr("data-id"),t.screenoptionnonce=jQuery("#screenoptionnonce").val(),jQuery("#location-"+t.location_id));o.css("background-color","#F2F2F2"),o.fadeOut(600),slp_Admin_Filter("ajax_post_ok").subscribe(function(a){o.remove()}),slp_Admin_Filter("ajax_post_info").subscribe(function(a){o.fadeIn(200)}),slp_Admin_Filter("ajax_post_failure").subscribe(function(a){o.fadeIn(200)}),SLP_ADMIN.ajax.post(t,{message_ok:"Location deleted.",message_info:"Could not delete location.",message_failure:"Could not communicate with the server."})},this.show_description=function(a){var t=jQuery(this).attr("data-value"),o=jQuery("#manage_locations_modal");o.html(t),o.dialog({maxHeight:400,modal:!0,width:520})},this.show_location_details=function(a){var t=new Object;t.action="slp_get_location",t.location_id=jQuery(this).attr("data-id"),alert(t.location_id)}},SLP_Locations_table_header=function(){this.initialize=function(){jQuery("#do_action_apply_to_all").on("click",this.execute_apply_to_all),jQuery("#do_action_apply").on("click",this.execute_apply)},this.execute_apply=function(){SLP_Location_Manager.table_header.execute_apply_bulk_action(!1)},this.execute_apply_to_all=function(){SLP_Location_Manager.table_header.execute_apply_bulk_action(!0)},this.execute_apply_bulk_action=function(a){var t,o=jQuery("#actionType").val();return"-1"!==o&&(t=jQuery("#actionType option:selected").text(),confirm("Are you sure you want to "+t+"?")&&(a&&jQuery("<input />").attr("type","hidden").attr("name","apply_to_all").attr("value","1").appendTo("#locationForm"),t=o+"BulkAction",slp_Admin_Filter(t).hasSubscriptions()?slp_Admin_Filter(t).publish():AdminUI.doAction(o))),!1}},SLP_Location_Card=function(){this.initialize=function(){jQuery("span.store_name").on("click",function(){SLP_Location_Manager.Card.show_location_details(jQuery(this).parents("tr").first())}),jQuery(".location-card").on("click",function(){SLP_Location_Manager.Form_Handler.hide(jQuery(".location-card"))})},this.show_location_details=function(a){var t,o,e=a.children(".slp_manage_locations_cell"),i=jQuery(".location-card"),n=["sl_store_complex"],r=jQuery(".location-card .primary .card-header"),r=(n.push(SLP_Location_Manager.Form_Handler.populate_field("sl_store",a,r)),n.push(SLP_Location_Manager.Form_Handler.populate_field("sl_address",a,r)),n.push(SLP_Location_Manager.Form_Handler.populate_field("sl_city",a,r)),n.push(SLP_Location_Manager.Form_Handler.populate_field("sl_state",a,r)),n.push(SLP_Location_Manager.Form_Handler.populate_field("sl_zip",a,r)),n.push(SLP_Location_Manager.Form_Handler.populate_field("sl_country",a,r)),jQuery(".location-card .primary .card-footer")),r=(n.push(SLP_Location_Manager.Form_Handler.populate_field("sl_id",a,r)),jQuery(".location-card .secondary")),l=(n.push(SLP_Location_Manager.Form_Handler.populate_field("sl_latitude",a,r)),n.push(SLP_Location_Manager.Form_Handler.populate_field("sl_longitude",a,r)),n.push(SLP_Location_Manager.Form_Handler.populate_field("sl_url",a,r)),jQuery(".location-card .card-body .card-info-grid"));l.html("");for(var _=0,c=e.length;_<c;_++)e[_]&&""!==e[_].innerHTML&&(t=jQuery(e[_]).attr("data-field"),o=jQuery(e[_]).attr("data-colname"),-1===jQuery.inArray(t,n)&&l.append('<div class="col"><strong class="label">'+o+'</strong><span contenteditable="true" data-field="'+t+'">'+e[_].innerHTML+"</span></div>"));var r=jQuery("#manage_locations_table").offset(),s=jQuery("#manage_locations_table").outerWidth(),d=a.offset(),a=a.outerHeight(),u=jQuery(".location-card").outerHeight(),a=d.top+a,r=jQuery(window).width()-(r.left+s);a+u>jQuery(window).height()&&(a=d.top-u),i.css({top:a,right:r}),SLP_Location_Manager.Form_Handler.show(i),SLP_Location_Manager.locations_map.show_map(i)},this.clear_more_info=function(){jQuery(".settings-description").toggleClass("is-visible").html("")}},SLP_Location_Editor=function(){const t=jQuery("#wpcsl-option-add");this.initialize=function(){jQuery('a[data-action="edit"]').on("click",function(){t.show(),SLP_Location_Manager.Editor.load_and_show_form(jQuery(this))}),jQuery("#wpcsl-option-add_sidemenu").on("click",function(){SLP_Location_Manager.Editor.load_and_show_form(jQuery(this))}),jQuery(".slp_icon_selector").on("click",function(){var a=jQuery(this).attr("src"),t=jQuery(this).closest("div.input-group");t.find("img.slp_settings_icon").attr("src",a).attr("src",a),t.find('input[type="text"]').val(a)})},this.close=function(){SLP_Location_Manager.vue.update_app.show_add_dialog=!1,jQuery("#wpcsl-option-current_locations_sidemenu").trigger("click")},this.load_and_show_form=function(a){this.load_form(t,a),SLP_Location_Manager.Form_Handler.hide(jQuery(".location-card")),jQuery("#myslp-header").on("click",this.close),jQuery("#dashboard-header").on("click",this.close),SLP_Location_Manager.vue.update_app.show_add_dialog=!0,SLP_Location_Manager.locations_map.show_map(t)},this.load_form=function(t,a){var o,e,i=jQuery("#locationForm"),n=a.attr("data-id"),a=(n?(SLP_Location_Manager.vue.update_app.act="save",o=jQuery('#manage_locations_table tr[data-id="'+n+'"]'),i.find("#id").val(n),i.find("#locationID").val(n),i.find("#wpcsl_settings_group-map").show(),e=location_manager.edit_text,o.find("[data-field]").each(function(a){SLP_Location_Manager.vue.update_app.location[jQuery(this).attr("data-field")]=jQuery(this).attr("data-value")})):(SLP_Location_Manager.vue.update_app.act="add",o=a,i.find("#id").val(n),i.find("#locationID").val(n),i.find("#wpcsl_settings_group-map").hide(),e=location_manager.add_text,SLP_Location_Manager.vue.update_app.location={}),SLP_Location_Manager.vue.update_app.location_manager.text.form_title=e,t.find("input :submit").each(function(a){var t=jQuery(this);t.attr("alt",e),t.attr("title",e),t.attr("onclick","")}),t.find("[data-field]").each(function(a){SLP_Location_Manager.Form_Handler.populate_field(jQuery(this).attr("data-field"),o,t)}),new Object);a.table_row=o,a.form_div=t,slp_Admin_Filter("location_edit_init").publish(a)}};jQuery(document).ready(function(){SLP_Location_Manager.vue.initialize(),SLP_Location_Manager.Form_Handler=new SLP_Location_Form_Handler,SLP_Location_Manager.locations_map=new SLP_Locations_map,SLP_Location_Manager.table=new SLP_Locations_table,SLP_Location_Manager.table.initialize(),SLP_Location_Manager.table_header=new SLP_Locations_table_header,SLP_Location_Manager.table_header.initialize();var a=new Object;a.stripeClasses=[],a.info=!1,a.paging=!1,a.searching=!1,a.responsive=!0,a.colReorder=!0,a.columnDefs=[{targets:[0,1],visible:!0,orderable:!1},{targets:"_all",visible:!0,searchable:!1,orderable:!0}],a.ordering=location_manager.all_displayed,SLP_Location_Manager.table=jQuery("#manage_locations_table").DataTable(a),jQuery("#wpcsl-option-current_locations div.section_description").is(":empty")&&jQuery("#wpcsl-option-add_location_sidemenu").trigger("click"),SLP_Location_Manager.Editor=new SLP_Location_Editor,SLP_Location_Manager.Editor.initialize(),SLP_Location_Manager.Card=new SLP_Location_Card,SLP_Location_Manager.Card.initialize()});
//# sourceMappingURL=admin-locations-tab.min.js.map